Metadata-Version: 2.4
Name: CellLabeller
Version: 0.1.0
Summary: An XGBoost-based end-to-end single cell annotation tool using scVI integration and transfer learning
Home-page: https://github.com/yourusername/CellLabeller
Author: Md. Adnan Karim
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Intended Audience :: Science/Research
Classifier: Topic :: Scientific/Engineering :: Bio-Informatics
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: anndata>=0.7.0
Requires-Dist: scanpy>=1.9.0
Requires-Dist: scvi-tools>=0.17.0
Requires-Dist: xgboost>=1.5.0
Requires-Dist: scikit-learn>=1.0.0
Requires-Dist: numpy>=1.21.0
Requires-Dist: pandas>=1.3.0
Requires-Dist: matplotlib>=3.4.0
Requires-Dist: seaborn>=0.11.0
Requires-Dist: tqdm>=4.62.0
Requires-Dist: joblib>=1.1.0
Requires-Dist: optuna>=2.10.0
Provides-Extra: dev
Requires-Dist: pytest>=6.0; extra == "dev"
Requires-Dist: black>=21.0; extra == "dev"
Requires-Dist: flake8>=3.9; extra == "dev"
Dynamic: author
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: license-file
Dynamic: provides-extra
Dynamic: requires-dist
Dynamic: requires-python
Dynamic: summary

# CellLabeller

An XGBoost-based end-to-end single cell annotation tool for transferring cell type labels from reference datasets to query datasets using scVI integration and machine learning.

## Overview

CellLabeller provides a complete pipeline for cell type label transfer in single-cell RNA-seq analysis:

1. **Gene Subsetting**: Automatically identifies and subsets both reference and query datasets to common genes
2. **scVI Integration**: Integrates reference and query datasets using scVI (≥200 epochs) for batch effect correction and latent space learning
3. **Feature Engineering**: Flexible feature selection combining gene expression and/or scVI latent space
4. **Hyperparameter Optimization**: Conducts comprehensive hyperparameter tuning for XGBoost with both GPU and CPU options
5. **Model Training & Evaluation**: Trains and evaluates models on training and test sets
6. **Prediction**: Predicts cell types for query cells with confidence scores

## Installation

### Option 1: Clone and Install from Repository

```bash
git clone https://github.com/yourusername/CellLabeller.git
cd CellLabeller
pip install -r requirements.txt
pip install -e .
```

### Quick Start

```python
import anndata as sc
from celllabeller import CellTypeLabelTransfer, FeatureEngineer, XGBoostTuner

# Load your data
adata_ref = sc.read_h5ad("reference_data.h5ad")
adata_query = sc.read_h5ad("query_data.h5ad")

# Initialize label transfer
label_transfer = CellTypeLabelTransfer(
    reference_adata=adata_ref,
    query_adata=adata_query,
    cell_type_key="cell_type",
    results_dir="./results",
    n_epochs=250,  # At least 200 as per requirement
)

# Step 1: Subset to common genes
label_transfer.subset_common_genes()

# Step 2: Integrate with scVI
adata_integrated = label_transfer.integrate_with_scvi()

# Step 3: Feature engineering
feature_engineer = FeatureEngineer(
    integrated_adata=adata_integrated,
    cell_type_key="cell_type",
    n_features_genes=500,
)

# Select features (genes, scvi_latent, or combined)
X_features, indices, feature_names = feature_engineer.select_features(
    feature_type="combined"  # Choose: "genes", "scvi_latent", or "combined"
)

# Step 4: Hyperparameter tuning and model training
tuner = XGBoostTuner(
    X_features=X_features,
    y_labels=adata_integrated.obs["cell_type"].values,
    results_dir=label_transfer.get_results_dir(),
)

# Compare GPU and CPU performance
comparison_df = tuner.compare_gpu_cpu()
```

## Features

✨ **Key Capabilities:**

- ✅ Automatic gene subsetting to common genes between datasets
- ✅ scVI-based integration with configurable epochs (minimum 200)
- ✅ Flexible feature engineering: genes, scVI latent space, or combined
- ✅ Bayesian hyperparameter optimization for XGBoost
- ✅ GPU and CPU acceleration comparison
- ✅ Comprehensive evaluation metrics
- ✅ Automatic model and results saving
- ✅ Ready-to-use tutorial notebook

## Documentation

See the [tutorial notebook](tutorial_label_transfer.ipynb) for a complete step-by-step guide.

Full API documentation is available in the docstrings of each module.

## Output Files

All results are saved in the `results_dir`:

```
results/
├── scvi_model/                    # Saved scVI model
├── xgboost_model_cpu.pkl          # Trained CPU model
├── xgboost_model_gpu.pkl          # Trained GPU model (if available)
├── label_encoder.pkl              # Label encoder
├── evaluation_results_*.pkl        # Performance metrics
├── query_predictions.csv           # Predictions as CSV
└── confusion_matrices.png          # Visualizations
```

## Requirements

- Python ≥ 3.8
- anndata, scanpy, scvi-tools
- xgboost, scikit-learn
- numpy, pandas, matplotlib, seaborn
- optuna (for hyperparameter tuning)

See `requirements.txt` for complete list.

## Performance

Typical processing times on standard hardware (1000 cells, 10k genes):
- Gene subsetting: < 1 second
- scVI integration (250 epochs): 5-15 minutes (GPU) / 30-60 minutes (CPU)
- Feature selection: < 1 minute
- Hyperparameter tuning (50 trials): 5-20 minutes (GPU)
- Model training: < 1 minute
- Prediction: < 1 second

## References

- Lopez, R., et al. (2018). "Deep generative modeling for single-cell transcriptomics." Nature Methods.
- Chen, T., & Guestrin, C. (2016). "XGBoost: A scalable tree boosting system." KDD.
- Wolf, F. A., et al. (2018). "SCANPY: Large-scale single-cell gene expression data analysis." Genome Biology.

## License

MIT License - See LICENSE file for details
